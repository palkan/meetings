<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
         xmlns:s="library://ns.adobe.com/flex/spark"
         width="100%" height="30" mask="{_newMask}">
    <fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
        private var _timer:Timer = new Timer(500, 0);
        [Bindable]
        private var _newMask:Sprite = new Sprite();
        private var _len:Number = 200;
        private var _mic:Microphone;

        public function set len(value:Number):void {
            _len = value;
        }

        public function startDisplay(micId:int = -1):void {
            _mic = Microphone.getMicrophone(micId);
            _mic.setLoopBack(true);
            _timer.addEventListener(TimerEvent.TIMER, onTimer);
            _timer.start();
            drawMask();
        }

        public function stopDisplay():void {
            _timer.removeEventListener(TimerEvent.TIMER, onTimer);
            _timer.stop();
            _mic = null;
            this.graphics.clear();
        }

        private function onTimer(evt:Event):void {
            drawR(_mic.activityLevel);
        }

        private function drawR(val:Number):void {
            this.graphics.clear();
            this.graphics.beginFill(0x00FF00, 1);
            this.graphics.drawRect(0, 0, val / 100 * _len, 20);
            this.graphics.endFill();
        }

        private function drawMask():void {
            _newMask.graphics.beginFill(0x0000FF, 1);
            var posX:Number = 0;
            while (posX <= _len) {
                _newMask.graphics.drawRoundRect(posX, 0, 17, 6, 3);
                posX += 20;
            }
            _newMask.graphics.endFill();
        }
        ]]>
	</fx:Script>
</s:Group>
